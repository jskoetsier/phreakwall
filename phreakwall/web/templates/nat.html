{% extends "base.html" %}
{% block title %}1:1 NAT - Phreakwall{% endblock %}
{% block content %}
<div class="card">
    <h2>ðŸ”€ 1:1 NAT Configuration</h2>
    <p style="color: #9ca3af; margin-bottom: 2rem;">Configure bidirectional one-to-one Network Address Translation (internal â†” external)</p>

    <div style="margin-bottom: 2rem;">
        <h3>Add NAT Rule</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
            <div class="form-group" style="margin-bottom: 0;">
                <input type="text" id="nat_external" placeholder="External IP">
            </div>
            <div class="form-group" style="margin-bottom: 0;">
                <input type="text" id="nat_internal" placeholder="Internal IP">
            </div>
            <div class="form-group" style="margin-bottom: 0;">
                <input type="text" id="nat_interface" placeholder="Interface">
            </div>
            <button class="btn" onclick="addNATRule()">âž• Add NAT Rule</button>
        </div>
    </div>

    <h3>NAT Rules</h3>
    <table>
        <thead>
            <tr>
                <th>External IP</th>
                <th>Internal IP</th>
                <th>Interface</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="nat-tbody">
            <tr>
                <td colspan="5" style="padding: 2rem; text-align: center; color: #9ca3af;">No NAT rules configured</td>
            </tr>
        </tbody>
    </table>
</div>

<div id="result"></div>

<script>
function addNATRule() {
    const external = document.getElementById('nat_external').value;
    const internal = document.getElementById('nat_internal').value;
    const iface = document.getElementById('nat_interface').value;

    if (!external || !internal || !iface) {
        document.getElementById('result').innerHTML = '<div class="alert alert-error">Please fill all fields</div>';
        return;
    }

    fetch('/api/nat', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({external, internal, interface: iface})
    })
    .then(response => response.json())
    .then(data => {
        document.getElementById('result').innerHTML = data.status === 'success'
            ? '<div class="alert alert-success">âœ“ ' + data.message + '</div>'
            : '<div class="alert alert-error">âœ— ' + data.message + '</div>';
        if (data.status === 'success') {
            document.getElementById('nat_external').value = '';
            document.getElementById('nat_internal').value = '';
            document.getElementById('nat_interface').value = '';
            loadNATRules();
        }
    });
}

function loadNATRules() {
    fetch('/api/nat')
        .then(response => response.json())
        .then(data => {
            const tbody = document.getElementById('nat-tbody');
            if (data.nat_rules.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="padding: 2rem; text-align: center; color: #888;">No NAT rules configured</td></tr>';
            }
        });
}

loadNATRules();
</script>
{% endblock %}
