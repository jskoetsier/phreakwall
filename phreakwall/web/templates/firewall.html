{% extends "base.html" %}
{% block title %}Firewall Rules - Phreakwall{% endblock %}
{% block content %}
<div class="card">
    <h2>üõ°Ô∏è Firewall Rules Configuration</h2>
    <p style="color: #9ca3af; margin-bottom: 2rem;">Define firewall rules and policies</p>

    <h3>Firewall Rules</h3>
    <div class="form-group">
        <textarea id="rules-editor" style="min-height: 300px;">{{ rules }}</textarea>
    </div>
    <button class="btn btn-success" onclick="saveRules()">üíæ Save Rules</button>

    <h3 style="margin-top: 2rem;">Zone Policies</h3>
    <div class="form-group">
        <textarea id="policy-editor" style="min-height: 200px;">{{ policy }}</textarea>
    </div>
    <button class="btn btn-success" onclick="savePolicies()">üíæ Save Policies</button>
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
    <div class="card">
        <h3 style="color: #00ff9d; margin-bottom: 1rem;">Rule Syntax Help</h3>
        <pre style="background: #1a1f3a; padding: 1rem; border-radius: 4px; overflow-x: auto; color: #e0e0e0;">
#ACTION    SOURCE    DEST    PROTO    DPORT
ACCEPT     net       fw      tcp      ssh
ACCEPT     loc       fw      tcp      80,443
DROP       net       fw      tcp      23
REJECT     all       all     tcp      telnet
        </pre>
    </div>

    <div class="card">
        <h3 style="color: #00ff9d; margin-bottom: 1rem;">Policy Syntax Help</h3>
        <pre style="background: #1a1f3a; padding: 1rem; border-radius: 4px; overflow-x: auto; color: #e0e0e0;">
#SOURCE    DEST    POLICY      LOG
fw         all     ACCEPT
loc        net     ACCEPT
net        all     DROP        info
all        all     REJECT      info
        </pre>
    </div>
</div>

<div id="result" style="margin-top: 1rem;"></div>

<script>
function saveRules() {
    const content = document.getElementById('rules-editor').value;

    fetch('/config/save/rules', {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: 'content=' + encodeURIComponent(content)
    })
    .then(response => {
        if (response.ok) {
            document.getElementById('result').innerHTML = '<div class="alert alert-success">‚úì Rules saved successfully</div>';
        } else {
            document.getElementById('result').innerHTML = '<div class="alert alert-error">‚úó Failed to save rules</div>';
        }
    });
}

function savePolicies() {
    const content = document.getElementById('policy-editor').value;

    fetch('/config/save/policy', {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: 'content=' + encodeURIComponent(content)
    })
    .then(response => {
        if (response.ok) {
            document.getElementById('result').innerHTML = '<div class="alert alert-success">‚úì Policies saved successfully</div>';
        } else {
            document.getElementById('result').innerHTML = '<div class="alert alert-error">‚úó Failed to save policies</div>';
        }
    });
}
</script>
{% endblock %}
